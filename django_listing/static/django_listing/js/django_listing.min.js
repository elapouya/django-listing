var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(a==Array.prototype||a==Object.prototype)return a;a[c]=b.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<a.length;++c){var b=a[c];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,c){var b=$jscomp.propertyToPolyfillSymbol[c];if(null==b)return a[c];b=a[b];return void 0!==b?b:a[c]};$jscomp.polyfill=function(a,c,b,e){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,c,b,e):$jscomp.polyfillUnisolated(a,c,b,e))};
$jscomp.polyfillUnisolated=function(a,c,b,e){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];if(!(d in b))return;b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(a,c,b,e){var d=a.split(".");a=1===d.length;e=d[0];e=!a&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in e))return;e=e[g]}d=d[d.length-1];b=$jscomp.IS_SYMBOL_NATIVE&&"es6"===b?e[d]:null;c=c(b);null!=c&&(a?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:c}):c!==b&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&(b=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+b+"$"+d),$jscomp.defineProperty(e,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:c})))};$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(c,b){var e=this;e instanceof String&&(e=String(e));var d=e.length;b=b||0;for(0>b&&(b=Math.max(b+d,0));b<d;b++){var f=e[b];if(f===c||Object.is(f,c))return!0}return!1}},"es7","es3");
function djlst_replaceUrlParam(a,c,b){null==b&&(b="");a=a.startsWith("/")?new URL(a,window.location.origin):new URL(a);a.searchParams.set(c,b);return a.toString()}function djlst_removeUrlParam(a,c){a=new URL(a);a.searchParams.delete(c);return a.toString()}function update_csrf_token(){$.ajaxSetup({data:{csrfmiddlewaretoken:Cookies.get("csrftoken")}})}
function djlst_load_listing_url(a,c){$("div.django-listing-ajax").length||(window.location.href=c);var b=a.closest("div.django-listing-ajax");b.addClass("spinning");var e=$(b).attr("id");b=$(b).attr("listing-suffix");var d=a.attr("listing-target");d||(d="#"+e);(a=a.attr("listing-part"))||(a="all");update_csrf_token();$.ajax({type:"POST",url:c,data:{listing_id:e,listing_suffix:b,listing_part:a},success:function(f){$(d).replaceWith(f);djlst_listing_on_load();$(document).trigger("djlst_ajax_loaded",
{listing_target:d})},error:function(f){text="An error occured.\n\nIndications :\n\n"+f.responseText;alert(text)}});return!1}function djlst_load_listing_href(){return djlst_load_listing_url($(this),$(this).attr("href"))}function djlst_load_listing_val(){var a=$(this).val(),c=$(this).attr("name"),b=$(this).closest("div.django-listing-ajax").attr("ajax_url");a=djlst_replaceUrlParam(b,c,a);return djlst_load_listing_url($(this),a)}
function djlst_post_action_button(a){a.preventDefault();var c=$(this),b=c.closest("div.django-listing-ajax");a=b.attr("ajax_url");b.addClass("spinning");var e=b.attr("id");b=b.attr("listing-suffix");var d=c.attr("listing-target");d||(d="#"+e);var f=c.attr("listing-part");f||(f="all");c={listing_id:e,listing_suffix:b,listing_part:f,serialized_data:c.closest("form").serialize()};c[$(this).attr("name")]=$(this).val();update_csrf_token();$.ajax({type:"POST",url:a,data:c,success:function(g){$(d).replaceWith(g);
djlst_listing_on_load();$(document).trigger("djlst_ajax_loaded",{listing_target:d})},error:function(g){text="An error occured.\n\nIndications :\n\n"+g.responseText;alert(text)}})}
function djlst_post_attached_form(a){a.preventDefault();a=$(this);let c=a.val(),b=a.closest("form.listing-form"),e=b.attr("id"),d=$("#"+b.attr("related-listing"));var f=d.find(".row-container.selected"),g=a.attr("confirm-msg");if(g){var h=a.attr("confirm-msg-nb-items");h=parseInt(h);isNaN(h)&&(h=0);g=g.replace("{nb_items}",f.length);(nb_all_items=d.attr("nb-rows"))||(nb_all_items="");g=g.replace("{nb_all_items}",nb_all_items);if(f.length>=h&&!confirm(g))return}g=f.map(function(){return $(this).attr("data-pk")}).get().join(",");
f=d.attr("ajax_url");h=d.attr("id");let p=d.attr("listing-suffix"),l=a.attr("listing-target");l||(l="#"+h);let m=a.attr("listing-part");m||(m="all");a={listing_id:h,listing_suffix:p,listing_part:m,action:"attached_form",action_button:c,selected_pks:g,serialized_data:a.closest("form").serialize()};update_csrf_token();$.ajax({type:"POST",url:f,data:a,success:function(k){let n;k.listing&&d.replaceWith(k.listing);k.attached_form&&(b.replaceWith(k.attached_form),djlst_selection_changed_hook(d));k.object_pk&&
(n=$("#"+e),n.find('input[name="object_pk"]').val(k.object_pk));$(document).trigger("djlst_ajax_attached_form_loaded",{listing:l,form:n})},error:function(k){text="An error occured.\n\nIndications :\n\n"+k.responseText;alert(text)}})}var djlst_last_selected_rows_container=null,djlst_last_selected_index=null;
function djlst_multiple_row_select(a){let c=$(this).closest(".row-container"),b=c.parent(),e=c.index(),d=djlst_last_selected_rows_container,f=djlst_last_selected_index,g=c.closest(".django-listing-container").hasClass("selection-multiple-ctrl"),h;h=c.hasClass("selected")?djlst_multiple_row_do_unselect:djlst_multiple_row_do_select;g&&!a.ctrlKey&&c.siblings().removeClass("selected");a.shiftKey&&d[0]===b[0]&&null!=f?(djlst_map_children_range(b,f,e,h),djlst_unselectText()):h(c);djlst_selection_changed_hook($(this));
djlst_last_selected_rows_container=b;djlst_last_selected_index=e}function djlst_map_children_range(a,c,b,e){rows=b>=c?a.children().slice(c,b+1):a.children().slice(b,c+1);rows.each(function(){e($(this))})}
function djlst_multiple_row_do_unselect(a){var c=a.find("input.row-select").first();a.removeClass("selected");c.removeAttr("name");a.find("input.selection-box").first().prop("checked",!1);if(1==a.siblings(".selected").length){a=a.siblings(".selected").first();var b=a.closest(".django-listing-container");c=$("#"+b.attr("attached-form-id"));c.length&&b.hasClass("attached_form_autofill")&&(b=a.attr("data-serialized-object"))&&(b=decodeURIComponent(escape(atob(b))),b=JSON.parse(b),a=a.attr("data-pk"),
djlst_fill_form(c,b,a))}}
function djlst_multiple_row_do_select(a){var c=a.find("input.row-select").first();a.addClass("selected");c.attr("name",c.attr("select-name"));a.find("input.selection-box").first().prop("checked",!0);var b=a.closest(".django-listing-container");c=$("#"+b.attr("attached-form-id"));if(c.length&&b.hasClass("attached_form_autofill"))if(0<a.siblings(".selected").length)djlst_clean_form(c);else if(b=a.attr("data-serialized-object"))b=decodeURIComponent(escape(atob(b))),b=JSON.parse(b),a=a.attr("data-pk"),
djlst_fill_form(c,b,a)}function djlst_unique_row_select(a){a=$(this).closest(".row-container");a.hasClass("selected")?djlst_multiple_row_do_unselect(a):(a.siblings().removeClass("selected").find("input.row-select").removeAttr("name"),djlst_multiple_row_do_select(a));djlst_selection_changed_hook($(this))}
function djlst_select_all(a){a=$(this).attr("listing-target");a=$("#"+a);a.find(".row-container.row-selector").addClass("selected");a.find("input.selection-box").prop("checked",!0);a.find("input.row-select").each(function(){let c=$(this);c.attr("name",c.attr("select-name"))});djlst_selection_changed_hook(a)}function djlst_unselect_all(a){a=$(this).attr("listing-target");a=$("#"+a);djlst_listing_unselect_all(a)}
function djlst_listing_unselect_all(a){a.find(".row-container.row-selector").removeClass("selected");a.find("input.selection-box").prop("checked",!1);a.find("input.row-select").each(function(){$(this).removeAttr("name")});djlst_selection_changed_hook(a)}
function djlst_invert_selection(a){a=$(this).attr("listing-target");a=$("#"+a);a.find(".row-container.row-selector").toggleClass("selected");a.find("input.selection-box").prop("checked",!0);a.find("input.row-select").each(function(){let c=$(this);void 0!==c.attr("name")?c.removeAttr("name"):c.attr("name",c.attr("select-name"))});djlst_selection_changed_hook(a)}function djlst_unselectText(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}
function djlst_activate_selection(a){a=$(this).closest("div.django-listing-selecting");a.find(".selection-overlay.hover").removeClass("hover").addClass("had-hover");var c=a.attr("selection-menu-id");c=$("#"+c);c.attr("listing-id",a.attr("id"));switch(c.attr("menu-display-mode")){case "show":c.show();break;case "fade":c.fadeIn(300);break;case "slide":c.slideDown(300)}djlst_selection_changed_hook($(this))}
function djlst_deactivate_selection(a){a=$(this).closest(".listing-selection-menu");var c=a.attr("listing-id");c=$("#"+c);c.find(".selection-overlay.had-hover").addClass("hover").removeClass("had-hover");djlst_listing_unselect_all(c);switch(a.attr("menu-display-mode")){case "show":a.hide();break;case "fade":a.fadeOut(300);break;case "slide":a.slideUp(300)}}
function djlst_selection_changed_hook(a){a=a.closest("div.django-listing-selecting");let c=a.find(".row-container.selected").length;0===c?$(".disabled-if-no-selection").addClass("disabled"):$(".disabled-if-no-selection:not(.no-perm)").removeClass("disabled");var b=a.attr("selection-menu-id");b&&(b=$("#"+b).find("span.selected_items"),0==c?b.text(b.attr("none")):1==c?b.text(b.attr("one")):b.text(b.attr("many").replace("{nb}",c)));$(document).trigger("djlst_selection_changed",{listing:a,count:c});console.log("trigger selection change")}
function djlst_fill_form(a,c,b){a.find('input[name="object_pk"]').val(b);a.find("input, select, textarea").each(function(){let e=$(this);var d=e.attr("name");if(void 0!==c.formfields&&d in c.formfields)d=c.formfields[d];else if(void 0!==c.fields&&d in c.fields)d=c.fields[d];else{if("hidden"===this.type||void 0!==c.data&&void 0!==c.data.no_autofill&&c.data.no_autofill.includes(d))return!0;d=""}if(e.is(":input"))if(e.is("input[type='radio']"))e.filter("[value='"+d+"']").prop("checked",!0);else if(e.is("input[type='checkbox']"))e.prop("checked",
d);else if(e.is("select")){let f=d;Array.isArray(d)&&(f=d[1],d=d[0]);"boolean"===typeof d&&(d=d?"True":"False");d||(d="");0===e.find("option[value='"+d+"']").length&&(e.hasClass("select2-hidden-accessible")&&e.empty(),e.append($("<option>",{value:d,text:f})));e.val(d);e.hasClass("select2-hidden-accessible")&&e.trigger("change")}else e.val(d)});$(document).trigger("djlst_form_filled",{form:a})}
function djlst_clean_form(a){a.find("input[type='text'],input[type='number'],textarea").val("");a.find("input[type='date'],input[type='time']").val("");a.find("input[type='datetime-local']").val("");a.find("select").each(function(c){0===$(this).find("option[value='']").length&&$(this).append($("<option>",{value:"",text:no_choice_msg}));$(this).val("")})}
function djlst_view_object_popup(a){a.preventDefault();a=$(this);var c=a.closest("div.django-listing-container"),b=c.attr("ajax_url");c.addClass("spinning");var e=c.attr("id"),d=c.attr("listing-suffix");request_data={listing_id:e,listing_suffix:d,action_button:"view_object_popup",serialized_data:a.closest("form").serialize()};update_csrf_token();$.ajax({type:"POST",url:b,data:request_data,success:function(f){c.removeClass("spinning");$("#listing-popup-container").html(f);$("#listing-popup-container > div.modal").modal("show")}})}
function djlst_listing_on_load(){$(".group-by-container").each(function(){let a=$(this).find(".group-by-select");new DualListbox(a[0],{addButtonText:">",removeButtonText:"<",addAllButtonText:">>",removeAllButtonText:"<<",availableTitle:a.attr("available-title")||"Available columns",selectedTitle:a.attr("selected-title")||"Selected columns"});let c=$(this).find(".annotation-select");new DualListbox(c[0],{addButtonText:">",removeButtonText:"<",addAllButtonText:">>",removeAllButtonText:"<<",availableTitle:c.attr("available-title")||
"Available columns",selectedTitle:c.attr("selected-title")||"Selected columns"});$(this).find(".apply-group-by").on("click",function(){var b=a.val().join(",");b=djlst_replaceUrlParam(window.location.href,"gb_cols",b);let e=c.val().join(",");b=djlst_replaceUrlParam(b,"gb_annotate_cols",e);djlst_load_listing_url($(this),b)});$(this).find(".remove-group-by").on("click",function(){let b=djlst_removeUrlParam(window.location.href,"gb_cols");b=djlst_removeUrlParam(b,"gb_annotate_cols");djlst_load_listing_url($(this),
b)})})}function djlst_follow_file_generation(){"done"!==Cookies.get("file_generation")?setTimeout(djlst_follow_file_generation,300):(Cookies.remove("file_generation"),$(".spinning").removeClass("spinning").addClass("done"))}
$(document).ready(function(){var a=!1;$("form.listing-form").submit(function(){$(this).find("input[name]").filter(function(){return!this.value}).prop("name","")});$(document.body).on("click","div.django-listing-ajax button.listing-nav",djlst_post_action_button);$(document.body).on("click","div.django-listing-ajax a.listing-nav",djlst_load_listing_href);$(document.body).on("change","div.django-listing-ajax select.listing-nav",djlst_load_listing_val);$(document.body).on("click","div.django-listing-selecting.selection_multiple .row-selector",
djlst_multiple_row_select);$(document.body).on("click","div.django-listing-selecting.selection_unique .row-selector",djlst_unique_row_select);$(document.body).on("click","div.django-listing-selecting .selection-overlay.hover",djlst_activate_selection);$(document.body).on("click","[listing-action='select-all']",djlst_select_all);$(document.body).on("click","[listing-action='unselect-all']",djlst_unselect_all);$(document.body).on("click","[listing-action='invert-selection']",djlst_invert_selection);
$(document.body).on("click",".listing-selection-menu .listing-menu-close",djlst_deactivate_selection);$(document.body).on("click","li.action-item.view-object-popup a",djlst_view_object_popup);$(document.body).on("click",".button-action-group-by",function(){$(this).closest(".django-listing-container").find(".group-by-container").slideToggle(200)});$(document.body).on("click","form.django-listing-ajax.attached-form button[name='action_button']",djlst_post_attached_form);$(document.body).on("click",
".btn.gb-filter",function(){$(this).addClass("visited")});$(".django-listing-container").each(function(){djlst_selection_changed_hook($(this))});$('[data-toggle="popover"]').popover();var c=0;$(".dropzone").on("dragenter",function(){c++;$(this).addClass("drag-over")});$(".dropzone").bind("dragleave",function(){c--;0===c&&$(this).removeClass("drag-over")});$(".dropzone").bind("drop",function(){c=0;$(this).removeClass("drag-over")});$(".submit-action-form").on("click",function(){var b=$(this).val(),
e=$(this).closest(".django-listing-container").find(".action-form");e.find(".action-hidden-value").val(b);e.submit()});$(document).on("select2:open",function(b){b=$(b.target).parent().find(".select2-selection").attr("aria-owns");document.querySelector('input[aria-controls="'+b+'"]').focus();a=!0});$("form").keyup(function(b){9==b.keyCode&&(b=$(b.target),b.hasClass("select2-selection")?(a||b.closest(".select2").siblings("select").first().select2("open"),a=!0):a=!1)});$(".file-generation-button").on("click",
function(){var b=$(this).siblings("select");if(b.length&&!b.val())return(b=$(this).data("empty-select-msg"))||(b="Please select a value !"),alert(b),!1;Cookies.set("file_generation","working",{expires:1});$(this).closest("div.django-listing-ajax").addClass("spinning").removeClass("done");djlst_follow_file_generation()});djlst_listing_on_load()});
