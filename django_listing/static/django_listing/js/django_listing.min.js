var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b,c){if(!c||null!=a){c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]}};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if("number"==typeof a.length)return $jscomp.arrayIterator(a);throw Error(String(a)+" is not an iterable or ArrayLike");};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)$jscomp.owns(b,d)&&c.push([d,b[d]]);return c}},"es8","es3");
function djlst_format_number(a){return String(a).replace(/\B(?=(\d{3})+(?!\d))/g," ")}const djlst_sleep=a=>new Promise(b=>setTimeout(b,a));$.fn.djlst_format_digits=function(){return this.each(function(){$(this).html();for(var a=function(c){if(3===c.nodeType){var d=c.nodeValue,e=d.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1\u00a0");d!==e&&(c.nodeValue=e)}else if(1===c.nodeType)for(d=0;d<c.childNodes.length;d++)a(c.childNodes[d])},b=0;b<this.childNodes.length;b++)a(this.childNodes[b])})};
function djlst_replaceUrlParam(a,b,c){null==c&&(c="");a=a.startsWith("/")?new URL(a,window.location.origin):new URL(a);a.searchParams.set(b,c);return a.toString()}function djlst_removeUrlParam(a,b){if(!a.startsWith("/")||!b||!b.length)return a;const [c,d]=a.split("?");if(!d)return a;const e=new URLSearchParams(d);b.forEach(f=>e.delete(f));return(a=e.toString())?`${c}?${a}`:c}function update_csrf_token(){$.ajaxSetup({data:{csrfmiddlewaretoken:Cookies.get("csrftoken")}})}
function djlst_get_form_data_advanced(a){a=new FormData(a);let b={};for(const [c,d]of a.entries())b[c]||(b[c]=1<a.getAll(c).length?a.getAll(c):d);return b}
function djlst_add_filter_request_data(a,b,c){var d=a.attr("id");d=$(`form[listing-id=${d}]`);if(d.length){const e=d.attr("method");void 0!==e&&"post"==e.toLowerCase()&&(d=djlst_get_form_data_advanced(d[0]),c=Object.assign({},c,d))}0==b.closest(".toolbar_item.variationstoolbaritem").length&&(b=a.find(".group-by-select"),b.length&&(c.gb_cols=b.val().join(",")),a=a.find(".annotation-select"),a.length&&(c.gb_annotate_cols=a.val().join(",")));return c}
function djlst_extract_params_from_url(a,b){a=a.split("?")[1]||"";const c=new URLSearchParams(a),d={};(Array.isArray(b)?b:[b]).forEach(e=>{c.has(e)&&(d[e]=c.get(e),c.delete(e))});return d}
function djlst_load_listing_url(a,b,c){null===b&&(b=djlst_get_requested_url(a));var d=djlst_extract_params_from_url(b,["variation"]);0<Object.keys(d).length&&(c=c?Object.assign({},c,d):d);$("div.django-listing-ajax").length||(window.location.href=b);const e=a.closest("div.django-listing-ajax");e.addClass("spinning");d=$(e).attr("id");const f=$(`form[listing-id=${d}]`),g=$(e).attr("listing-suffix");let k=a.attr("listing-target");k||(k="#"+d);let h=a.attr("listing-part");h||(h="all");d={listing_id:d,
listing_suffix:g,listing_part:h};d=djlst_add_filter_request_data(e,a,d);c&&(d=Object.assign({},d,c));$(document).trigger("djlst_before_load_listing_url",{listing:k,url:b,payload:d});update_csrf_token();$.ajax({type:"POST",url:b,data:d,traditional:!0,success:function(l){l.filters_form&&(f.replaceWith(l.filters_form),e.removeClass("spinning"));l.listing&&(e.replaceWith(l.listing),djlst_listing_on_load(),$(document).trigger("djlst_ajax_loaded",{listing_target:k,response:l.listing}))},error:function(l){text=
"An error occured.\n\nIndications :\n\n"+l.responseText;alert(text)}});$(document).trigger("djlst_after_load_listing_url");return!1}function djlst_load_listing_href(){return djlst_load_listing_url($(this),$(this).attr("href"))}function djlst_load_listing_val(){var a=$(this).val(),b=$(this).attr("name"),c=$(this).closest("div.django-listing-ajax").attr("ajax_url");a=djlst_replaceUrlParam(c,b,a);return djlst_load_listing_url($(this),a)}
function djlst_post_action_button(a){a.preventDefault();a=$(this);const b=a.closest("div.django-listing-ajax"),c=b.attr("ajax_url");b.addClass("spinning");var d=b.attr("id");const e=$(`form[listing-id=${d}]`),f=b.attr("listing-suffix");let g=a.attr("listing-target");g||(g="#"+d);let k=a.attr("listing-part");k||(k="all");d={listing_id:d,listing_suffix:f,listing_part:k,serialized_data:a.closest("form").serialize()};d[$(this).attr("name")]=$(this).val();d=djlst_add_filter_request_data(b,a,d);update_csrf_token();
$(document).trigger("djlst_before_post_action_button",{listing:g,payload:d});$.ajax({type:"POST",url:c,data:d,traditional:!0,success:function(h){h.filters_form&&(e.replaceWith(h.filters_form),b.removeClass("spinning"));h.listing&&(b.replaceWith(h.listing),djlst_listing_on_load(),$(document).trigger("djlst_ajax_loaded",{listing_target:g,response:h.listing}))},error:function(h){text="An error occured.\n\nIndications :\n\n"+h.responseText;alert(text)}});$(document).trigger("djlst_after_post_action_button",
{listing:g,payload:d})}var djlst_mass_op_cbs_displayed=!1;function djlst_show_mass_op_cbs(a){djlst_mass_op_cbs_displayed=!1;a.find(".mass-op-cb").prop("checked",!1).show();a.addClass("mass-op-cbs-displayed");setTimeout(function(){djlst_mass_op_cbs_displayed=!0},100)}function djlst_hide_mass_op_cbs(a){a.find(".mass-op-cb").hide();a.removeClass("mass-op-cbs-displayed");djlst_mass_op_cbs_displayed&&a.find(".form-buttons button.clear")[0].click();djlst_mass_op_cbs_displayed=!1}
function djlst_post_attached_form(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){a.preventDefault();const c=$(b),d=c.closest("form").find(".form-fields");var e=c.val();const f=c.closest("form.listing-form"),g=f.closest(".attached-form-container");let k=f.attr("id"),h=$("#"+f.attr("related-listing"));var l=h.find(".row-container.selected");!c.hasClass("flip")&&g.hasClass("flipped")&&(d.addClass("flip-out"),f.hasClass("animate")&&(yield djlst_sleep(300)));"update_all"==
e&&h.find(".row-container").addClass("selected");if("update_all"==e||"update"==e&&1<l.length){var m=f.find("input.mass-op-cb:visible").length;0==m&&(djlst_show_mass_op_cbs(f),djlst_clear_form(f));if(0==f.find("input.mass-op-cb:checked").length||0==m){setTimeout(function(){alert(use_mass_cb_msg)},50);return}}"clear"==e&&djlst_listing_unselect_all(h);if(m=c.attr("confirm-msg")){var p=c.attr("confirm-msg-nb-items");p=parseInt(p);isNaN(p)&&(p=0);m=m.replace("{nb_items}",l.length);var q=h.attr("nb-rows");
q||(q="");m=m.replace("{nb_all_items}",q);if(l.length>=p&&!confirm(m))return}c.hasClass("flip")&&(d.addClass("flip-out"),g.addClass("flipped"),f.hasClass("animate")&&(yield djlst_sleep(300)));m=l.map(function(){return $(this).attr("data-pk")}).get().join(",");l=h.attr("ajax_url");let u=h.attr("id");p=h.attr("listing-suffix");let t=c.attr("listing-target");t||(t="#"+u);(q=c.attr("listing-part"))||(q="all");e={listing_id:u,listing_suffix:p,listing_part:q,action:"attached_form",action_button:e,selected_pks:m,
serialized_data:c.closest("form").serialize()};e=djlst_add_filter_request_data(h,c,e);$(document).trigger("djlst_before_attached_form_post",{listing:t,form:f,payload:e,nav_obj:c});update_csrf_token();$.ajax({type:"POST",url:l,data:e,traditional:!0,success:function(n){let r;n.listing&&(h.replaceWith(n.listing),h=$("#"+u),djlst_listing_on_load());n.attached_form&&(f.replaceWith(n.attached_form),djlst_selection_changed_hook(h),g.hasClass("flipped")&&(r=$("#"+k),r.find(".mass-op-cb").hide(),r.removeClass("mass-op-cbs-displayed"),
djlst_mass_op_cbs_displayed=!1));n.object_pk&&(r=$("#"+k),r.find('input[name="object_pk"]').val(n.object_pk));$(document).trigger("djlst_ajax_attached_form_loaded",{listing:t,form:r,response:n});c.hasClass("flip")&&""!==n.layout_name||!g.hasClass("flipped")||setTimeout(()=>{g.removeClass("flipped");d.removeClass("flip-out")},300)},error:function(n){text="An error occured.\n\nIndications :\n\n"+n.responseText;alert(text)}});$(document).trigger("djlst_after_attached_form_post",{listing:t,form:f,payload:e,
nav_obj:c})})}var djlst_last_selected_rows_container=null,djlst_last_selected_index=null;
function djlst_multiple_row_select(a){let b=$(this).closest(".row-container"),c=b.parent(),d=b.index(),e=djlst_last_selected_rows_container,f=djlst_last_selected_index,g=b.closest(".django-listing-container").hasClass("selection-multiple-ctrl"),k;k=b.hasClass("selected")?djlst_multiple_row_do_unselect:djlst_multiple_row_do_select;g&&!a.ctrlKey&&b.siblings().removeClass("selected");a.shiftKey&&e[0]===c[0]&&null!=f?(djlst_map_children_range(c,f,d,k),djlst_unselectText()):k(b);djlst_selection_changed_hook($(this));
djlst_last_selected_rows_container=c;djlst_last_selected_index=d}function djlst_map_children_range(a,b,c,d){rows=c>=b?a.children().slice(b,c+1):a.children().slice(c,b+1);rows.each(function(){d($(this))})}
function djlst_multiple_row_do_unselect(a){var b=a.closest(".django-listing-container");$("#"+b.attr("attached-form-id"));b=a.find("input.row-select").first();a.removeClass("selected");b.removeAttr("name");a.find("input.selection-box").first().prop("checked",!1);if(1==a.siblings(".selected").length){a=a.siblings(".selected").first();var c=a.closest(".django-listing-container");b=$("#"+c.attr("attached-form-id"));b.length&&c.hasClass("attached_form_autofill")&&(c=a.attr("data-serialized-object"))&&
(c=decodeURIComponent(escape(atob(c))),c=JSON.parse(c),a=a.attr("data-pk"),djlst_fill_form(b,c,a))}}
function djlst_multiple_row_do_select(a){var b=a.find("input.row-select").first();a.addClass("selected");b.attr("name",b.attr("select-name"));a.find("input.selection-box").first().prop("checked",!0);var c=a.closest(".django-listing-container");b=$("#"+c.attr("attached-form-id"));b.length&&(b.find(".form-field.errors > span").remove(),b.find(".form-field.errors > ul.errorlist").remove(),b.find("ul.errorlist.nonfield").remove(),b.find(".form-field.errors").removeClass("errors"),c.hasClass("attached_form_autofill")&&
0==a.siblings(".selected").length&&(c=a.attr("data-serialized-object")))&&(c=decodeURIComponent(escape(atob(c))),c=JSON.parse(c),a=a.attr("data-pk"),djlst_fill_form(b,c,a))}function djlst_unique_row_select(a){a=$(this).closest(".row-container");a.hasClass("selected")?djlst_multiple_row_do_unselect(a):(a.siblings().removeClass("selected").find("input.row-select").removeAttr("name"),djlst_multiple_row_do_select(a));djlst_selection_changed_hook($(this))}
function djlst_select_all(a){a=$(this).attr("listing-target");a=$("#"+a);a.find(".row-container").addClass("selected");a.find("input.selection-box").prop("checked",!0);a.find("input.row-select").each(function(){let b=$(this);b.attr("name",b.attr("select-name"))});djlst_selection_changed_hook(a)}function djlst_unselect_all(a){a=$(this).attr("listing-target");a=$("#"+a);djlst_listing_unselect_all(a)}
function djlst_listing_unselect_all(a){a.find(".row-container").removeClass("selected");a.find("input.selection-box").prop("checked",!1);a.find("input.row-select").each(function(){$(this).removeAttr("name")});djlst_selection_changed_hook(a)}
function djlst_invert_selection(a){a=$(this).attr("listing-target");a=$("#"+a);a.find(".row-container").toggleClass("selected");a.find("input.selection-box").prop("checked",!0);a.find("input.row-select").each(function(){let b=$(this);void 0!==b.attr("name")?b.removeAttr("name"):b.attr("name",b.attr("select-name"))});djlst_selection_changed_hook(a)}function djlst_unselectText(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}
function djlst_activate_selection(a){a=$(this).closest("div.django-listing-selecting");a.find(".selection-overlay.hover").removeClass("hover").addClass("had-hover");var b=a.attr("selection-menu-id");b=$("#"+b);b.attr("listing-id",a.attr("id"));switch(b.attr("menu-display-mode")){case "show":b.show();break;case "fade":b.fadeIn(300);break;case "slide":b.slideDown(300)}djlst_selection_changed_hook($(this))}
function djlst_deactivate_selection(a){a=$(this).closest(".listing-selection-menu");var b=a.attr("listing-id");b=$("#"+b);b.find(".selection-overlay.had-hover").addClass("hover").removeClass("had-hover");djlst_listing_unselect_all(b);switch(a.attr("menu-display-mode")){case "show":a.hide();break;case "fade":a.fadeOut(300);break;case "slide":a.slideUp(300)}}
function djlst_get_requested_url(a){a=a.closest("div.django-listing-container").find("input[name='requested_url']");return a.length?a.val():window.location.href}function djlst_reload_listing_from_form(a,b){if(a){var c={src_elt_name:a.name,src_elt_value:a.value,src_elt_class:a.className};b=b?Object.assign({},b,c):c}a=$(a).closest(".listing-form").attr("listing-id");a=$("#"+a);c=djlst_get_requested_url(a);djlst_load_listing_url(a,c,b)}
function djlst_update_attached_form_buttons(a,b){const c=a.attr("nb-rows");"0"===c?b.find("button.all-count").addClass("disabled"):b.find("button.all-count:not(.no-perm)").removeClass("disabled");var d=$("#"+a.attr("attached-form-id"));let e=a.find(".row-container.selected").length;0===e?($(".selected-count,.disabled-if-no-selection").addClass("disabled"),b.find("button.hide-if-no-selection").hide(),b.find("button.hide-if-selection").show()):($(".selected-count:not(.no-perm),.disabled-if-no-selection:not(.no-perm)").removeClass("disabled"),
b.find("button.hide-if-no-selection").show(),b.find("button.hide-if-selection").hide());1<e?(djlst_clear_form(d),djlst_show_mass_op_cbs(d)):djlst_hide_mass_op_cbs(d);if(a=a.attr("selection-menu-id"))a=$("#"+a).find("span.selected_items"),0==e?a.text(a.attr("none")):1==e?a.text(a.attr("one")):a.text(a.attr("many").replace("{nb}",e));a=`<span class="badge rounded-pill text-bg-dark">${e}</span>`;d=`<span class="badge rounded-pill text-bg-dark">${c}</span>`;b.find("button.selected-count span.button-extra-middle").html(a);
b.find("button.all-count span.button-extra-middle").html(d);return{selected_count:e,all_count:c}}function djlst_selection_changed_hook(a){a=a.closest("div.django-listing-selecting");var b=$('body form[related-listing="'+a.attr("id")+'"]');b=djlst_update_attached_form_buttons(a,b);$(document).trigger("djlst_selection_changed",{listing:a,selected_count:b.selected,all_count:b.all})}
function djlst_fill_form(a,b,c){a.find('input[name="object_pk"]').val(c);a.find("input, select, textarea").each(function(){let d=$(this);var e=d.attr("name");if(void 0!==b.formfields&&e in b.formfields)e=b.formfields[e];else if(void 0!==b.fields&&e in b.fields)e=b.fields[e];else{if("hidden"===this.type||void 0!==b.data&&void 0!==b.data.no_autofill&&b.data.no_autofill.includes(e))return!0;e=""}if(d.is(":input"))if(d.is("input[type='radio']"))d.filter("[value='"+e+"']").prop("checked",!0);else if(d.is("input[type='checkbox']"))d.prop("checked",
e);else if(d.is("select"))if(Array.isArray(e)&&e.every(Array.isArray)){d.empty();for(const [f,g]of e)d.append($("<option>",{value:f,text:g,selected:!0}));d.trigger("change")}else{let f=e;Array.isArray(e)&&(f=e[1],e=e[0]);"boolean"===typeof e&&(e=e?"True":"False");e||(e="");0===d.find("option[value='"+e+"']").length&&(d.hasClass("select2-hidden-accessible")&&d.empty(),d.append($("<option>",{value:e,text:f})));d.val(e);d.hasClass("select2-hidden-accessible")&&d.trigger("change")}else d.val(e)});$(document).trigger("djlst_form_filled",
{form:a})}
function djlst_clear_form(a){a.find("input[type='text']:not(.mass-op-no-clear),input[type='number']:not(.mass-op-no-clear),textarea:not(.mass-op-no-clear)").attr("disabled",!1).val("");a.find("input[type='date']:not(.mass-op-no-clear),input[type='time']:not(.mass-op-no-clear)").attr("disabled",!1).val("");a.find("input[type='datetime-local']:not(.mass-op-no-clear)").attr("disabled",!1).val("");a.find("input:checkbox").attr("disabled",!1).prop("checked",!1);a.find("select:not(.mass-op-no-clear)").each(function(b){0===$(this).find("option[value='']").length&&
$(this).append($("<option>",{value:"",text:no_choice_msg}));$(this).attr("disabled",!1).val("").trigger("change")})}
function djlst_view_object_popup(a){a.preventDefault();a=$(this);var b=a.closest("div.django-listing-container"),c=b.attr("ajax_url");b.addClass("spinning");var d=b.attr("id"),e=b.attr("listing-suffix");request_data={listing_id:d,listing_suffix:e,action_button:"view_object_popup",serialized_data:a.closest("form").serialize()};request_data=djlst_add_filter_request_data(b,a,request_data);update_csrf_token();$.ajax({type:"POST",url:c,data:request_data,traditional:!0,success:function(f){b.removeClass("spinning");
$("#listing-popup-container").html(f);$("#listing-popup-container > div.modal").modal("show")}})}
function djlst_listing_on_load(){$(".group-by-container").each(function(){var a=$(this).find(".group-by-select");new DualListbox(a[0],{addButtonText:">",removeButtonText:"<",addAllButtonText:">>",removeAllButtonText:"<<",availableTitle:a.attr("available-title")||"Available columns",selectedTitle:a.attr("selected-title")||"Selected columns"});a=$(this).find(".annotation-select");new DualListbox(a[0],{addButtonText:">",removeButtonText:"<",addAllButtonText:">>",removeAllButtonText:"<<",availableTitle:a.attr("available-title")||
"Available columns",selectedTitle:a.attr("selected-title")||"Selected columns"})});$(".django-listing-container.format-numbers .type-Decimal,.django-listing-container.format-numbers .type-int,.django-listing-container.format-numbers .type-float,.django-listing-container.format-numbers .format-number").djlst_format_digits();$(".django-listing-container").each(function(){const a=$(this),b=$('body form[related-listing="'+this.id+'"]');djlst_update_attached_form_buttons(a,b)})}
function djlst_attached_form_input_changed(a){djlst_mass_op_cbs_displayed&&$(this).closest(".form-field").find(".mass-op-cb:visible").prop("checked",!0)}
function djlst_reset_form_fields(a){a.find('input[type="text"],                input[type="password"],                input[type="date"],                input[type="email"],                input[type="number"],                input[type="tel"],                input[type="url"],                input[type="search"],                textarea').val("");a.find('input[type="checkbox"],                input[type="radio"]').prop("checked",!1);a.find("select").prop("selectedIndex",-1);a.find('input[type="file"]').val("");
a.find("select").each(function(){$(this).hasClass("select2-hidden-accessible")&&$(this).val(null).trigger("change")})}
function djlst_empty_form_fields(a){a.find('input[type="text"], input[type="pasword"], input[type="date"], input[type="number"], textarea').val("");a.find("select").not(".select2-hidden-accessible").val("");a.find("select.select2-hidden-accessible").each(function(){$(this).val(null).trigger("change")});a.find('input[type="radio"]').each(function(){$(this).val()?$(this).prop("checked",!1):$(this).prop("checked",!0)});a.find('input[type="checkbox"]').prop("checked",!1);a.find('input[type="file"]').val("")}
function djlst_patch_form_data(a,b){a.on("submit",function(c){for(const [d,e]of Object.entries(b))c=a.find(`input[name="${d}"]`),c.length?c.val(e):(c=$("<input>",{type:"hidden",name:d,value:e}),a.append(c))})}
$(document).ready(function(){function a(d){var e=document.querySelector(".attached-form-container.sticky .attached-form");if(e){const f=window.pageYOffset||document.documentElement.scrollTop,g=document.documentElement.clientHeight;if(!(e.getBoundingClientRect().height>=g&&0<f)||d)if(d=Math.max(0,f-e.parentElement.offsetTop),e.style.marginTop=d+"px",e=document.querySelector(".toggle-attached-form"))e.style.marginTop=d+"px"}}$(document.body).on("click",".filters-form .advanced-button",function(){$(this).closest(".filters-form").find(".filters-layout-advanced").slideToggle();
$(this).find(".button-icon.up").toggle();$(this).find(".button-icon.down").toggle()});var b=!1;$("form.listing-form").submit(function(){$(this).find("input[name]").filter(function(){return!this.value}).prop("name","")});$(document.body).on("click","div.django-listing-ajax button.listing-nav",djlst_post_action_button);$(document.body).on("click","div.django-listing-ajax a.listing-nav",djlst_load_listing_href);$(document.body).on("change","div.django-listing-ajax select.listing-nav",djlst_load_listing_val);
$("div.django-listing-selecting td.col-selection_checkbox").length?($(document.body).on("click","div.django-listing-selecting.selection_multiple .row-selector td.col-selection_checkbox",djlst_multiple_row_select),$(document.body).on("click","div.django-listing-selecting.selection_unique .row-selector td.col-selection_checkbox",djlst_unique_row_select)):($(document.body).on("click","div.django-listing-selecting.selection_multiple .row-selector",djlst_multiple_row_select),$(document.body).on("click",
"div.django-listing-selecting.selection_unique .row-selector",djlst_unique_row_select));$(document.body).on("click","div.django-listing-selecting .selection-overlay.hover",djlst_activate_selection);$(document.body).on("click","[listing-action='select-all']",djlst_select_all);$(document.body).on("click","[listing-action='unselect-all']",djlst_unselect_all);$(document.body).on("click","[listing-action='invert-selection']",djlst_invert_selection);$(document.body).on("click",".listing-selection-menu .listing-menu-close",
djlst_deactivate_selection);$(document.body).on("click","li.action-item.view-object-popup a",djlst_view_object_popup);$(document.body).on("click",".button-action-group-by",function(){$(this).closest(".django-listing-container").find(".group-by-container").slideToggle(200)});$(document.body).on("click","form.django-listing-ajax.attached-form button[name='action_button']",djlst_post_attached_form);$(document.body).on("click",".btn.gb-filter",function(){$(this).addClass("visited")});$(document.body).on("change",
".attached-form-container input:not(.mass-op-cb)",djlst_attached_form_input_changed);$(document.body).on("change",".attached-form-container select,.attached-form-container textarea",djlst_attached_form_input_changed);$(document.body).on("click",".listing-form.filters-form-ajax .submit-button",function(){djlst_reload_listing_from_form(this);return!1});$(document.body).on("click",".listing-form.filters-form-ajax button.reset-button",function(d){d.preventDefault();let e=new URL(window.location.href);
e.searchParams.forEach(function(f,g){g.startsWith("f_")&&e.searchParams.delete(g)});window.location.href=e.toString()});$(".django-listing-container").each(function(){djlst_selection_changed_hook($(this))});$(document.body).on("click",".apply-group-by",function(){djlst_load_listing_url($(this),null)});$(document.body).on("click",".remove-group-by",function(){$(this).closest("div.django-listing-ajax").find(".group-by-container select").val("");let d=djlst_get_requested_url($(this));d=djlst_removeUrlParam(d,
["sort","page","per_page"]);djlst_load_listing_url($(this),d)});$('[data-toggle="popover"]').popover();var c=0;$(".dropzone").on("dragenter",function(){c++;$(this).addClass("drag-over")});$(".dropzone").bind("dragleave",function(){c--;0===c&&$(this).removeClass("drag-over")});$(".dropzone").bind("drop",function(){c=0;$(this).removeClass("drag-over")});$(document.body).on("click",".submit-action-form",function(){var d=$(this).val(),e=$(this).closest(".django-listing-container").find(".action-form");
e.find(".action-hidden-value").val(d);e.submit()});$(document).on("select2:open",function(d){d=$(d.target).parent().find(".select2-selection").attr("aria-owns");document.querySelector('input[aria-controls="'+d+'"]')&&(document.querySelector('input[aria-controls="'+d+'"]').focus(),b=!0)});$("form").keyup(function(d){9==d.keyCode&&(d=$(d.target),d.hasClass("select2-selection")?(b||d.closest(".select2").siblings("select").first().select2("open"),b=!0):b=!1)});$('form.attached-form input[type="text"], form.attached-form input[type="number"]').on("keypress",
function(d){if(13===d.which)return d.preventDefault(),$(this).blur().focus(),!1});$(document.body).on("click",".file-generation-button",function(){function d(){"done"!==Cookies.get("file_generation")?setTimeout(d,300):(Cookies.remove("file_generation"),$(".spinning").removeClass("spinning").addClass("done"),$(document).trigger("djlst_after_file_generation",{listing:g,filter_data:k,payload:h}))}var e=$(this),f=$(this).siblings("select");if(f.length&&!f.val())return(f=$(this).data("empty-select-msg"))||
(f="Please select a value !"),alert(f),!1;f=$(this).closest("form");const g=f.closest(".django-listing-container"),k=djlst_add_filter_request_data(g,e,{});e=djlst_get_requested_url(e).split("?")[1];(e=(new URLSearchParams(e)).get("sort"))&&(k.sort=e);e=f.serializeArray();let h={};$.each(e,function(l,m){h[m.name]=m.value});$(document).trigger("djlst_before_file_generation",{listing:g,filter_data:k,payload:h});djlst_patch_form_data(f,k);Cookies.set("file_generation","working",{expires:1});$(this).closest("div.django-listing-ajax").addClass("spinning").removeClass("done");
d()});$(".attached-form-container.sticky .attached-form").length&&($(window).on("scroll resize",()=>a(!1)),$(document).on("djlst_selection_changed djlst_form_filled",()=>a(!0)));djlst_listing_on_load()});
