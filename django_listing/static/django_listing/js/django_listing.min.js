function djlst_replaceUrlParam(a,b,c){null==c&&(c="");a=a.startsWith("/")?new URL(a,window.location.origin):new URL(a);a.searchParams.set(b,c);return a.toString()}function djlst_removeUrlParam(a,b){a=new URL(a);a.searchParams.delete(b);return a.toString()}
function get_csrf_token(){name="csrftoken";let a=null;if(document.cookie&&""!==document.cookie){const b=document.cookie.split(";");for(let c=0;c<b.length;c++){const d=b[c].trim();if(d.substring(0,name.length+1)===name+"="){a=decodeURIComponent(d.substring(name.length+1));break}}}return a}function update_csrf_token(){$.ajaxSetup({data:{csrfmiddlewaretoken:get_csrf_token()}})}
function djlst_load_listing_url(a,b){$("div.django-listing-ajax").length||(window.location.href=b);var c=a.closest("div.django-listing-ajax");c.addClass("spinning");var d=$(c).attr("id"),f=$(c).attr("listing-suffix"),e=a.attr("listing-target");e||(e="#"+d);(a=a.attr("listing-part"))||(a="all");update_csrf_token();$(e).load(b,{listing_id:d,listing_suffix:f,listing_part:a},function(g,h,k){"error"==h?(c.removeClass("spinning"),alert(g)):$(this).children(":first").unwrap();djlst_listing_on_load();$(document).trigger("djlst_ajax_loaded",
[e])});return!1}function djlst_load_listing_href(){return djlst_load_listing_url($(this),$(this).attr("href"))}function djlst_load_listing_val(){var a=$(this).val(),b=$(this).attr("name"),c=$(this).closest("div.django-listing-ajax").attr("ajax_url");a=djlst_replaceUrlParam(c,b,a);return djlst_load_listing_url($(this),a)}
function djlst_post_button_action(a){a.preventDefault();a=$(this);var b=a.closest("div.django-listing-ajax"),c=b.attr("ajax_url");b.addClass("spinning");var d=b.attr("id");b=b.attr("listing-suffix");var f=a.attr("listing-target");f||(f="#"+d);var e=a.attr("listing-part");e||(e="all");request_data={listing_id:d,listing_suffix:b,listing_part:e,serialized_data:a.closest("form").serialize()};request_data[$(this).attr("name")]=$(this).val();update_csrf_token();$.ajax({type:"POST",url:c,data:request_data,
success:function(g){$(f).html(g);$(f).children(":first").unwrap();djlst_listing_on_load();$(document).trigger("djlst_ajax_loaded",[f])}})}var djlst_last_selected_rows_container=null,djlst_last_selected_index=null;
function djlst_multiple_row_select(a){let b=$(this).closest(".row-container"),c=b.parent(),d=b.index(),f=djlst_last_selected_rows_container,e=djlst_last_selected_index,g;g=b.hasClass("selected")?djlst_multiple_row_do_unselect:djlst_multiple_row_do_select;a.shiftKey&&f[0]===c[0]&&null!=e?djlst_map_children_range(c,e,d,g):g(b);djlst_selection_menu_update($(this));djlst_last_selected_rows_container=c;djlst_last_selected_index=d}
function djlst_map_children_range(a,b,c,d){rows=c>=b?a.children().slice(b,c+1):a.children().slice(c,b+1);rows.each(function(){d($(this))})}function djlst_multiple_row_do_unselect(a){let b=a.find("input.row-select").first();a.removeClass("selected");b.removeAttr("name");a.find("input.selection-box").first().prop("checked",!1)}
function djlst_multiple_row_do_select(a){let b=a.find("input.row-select").first();a.addClass("selected");b.attr("name",b.attr("select-name"));a.find("input.selection-box").first().prop("checked",!0)}function djlst_unique_row_select(a){a=$(this).closest(".row-container");a.hasClass("selected")?djlst_multiple_row_do_unselect(a):(a.siblings().removeClass("selected").find("input.row-select").removeAttr("name"),djlst_multiple_row_do_select(a));djlst_selection_menu_update($(this))}
function djlst_select_all(a){a=$(this).attr("listing-target");a=$("#"+a);a.find(".row-container").addClass("selected");a.find("input.selection-box").prop("checked",!0);a.find("input.row-select").each(function(){var b=$(this);b.attr("name",b.attr("select-name"))});djlst_selection_menu_update(a)}function djlst_unselect_all(a){a=$(this).attr("listing-target");a=$("#"+a);djlst_listing_unselect_all(a)}
function djlst_listing_unselect_all(a){a.find(".row-container").removeClass("selected");a.find("input.selection-box").prop("checked",!1);a.find("input.row-select").each(function(){$(this).removeAttr("name")});djlst_selection_menu_update(a)}
function djlst_activate_selection(a){a=$(this).closest("div.django-listing-selecting");a.find(".selection-overlay.hover").removeClass("hover").addClass("had-hover");var b=a.attr("selection-menu-id");b=$("#"+b);b.attr("listing-id",a.attr("id"));switch(b.attr("menu-display-mode")){case "show":b.show();break;case "fade":b.fadeIn(300);break;case "slide":b.slideDown(300)}djlst_selection_menu_update($(this))}
function djlst_deactivate_selection(a){a=$(this).closest(".listing-selection-menu");var b=a.attr("listing-id");b=$("#"+b);b.find(".selection-overlay.had-hover").addClass("hover").removeClass("had-hover");djlst_listing_unselect_all(b);switch(a.attr("menu-display-mode")){case "show":a.hide();break;case "fade":a.fadeOut(300);break;case "slide":a.slideUp(300)}}
function djlst_selection_menu_update(a){a=a.closest("div.django-listing-selecting");var b=a.attr("selection-menu-id");b&&(b=$("#"+b).find("span.selected_items"),a=a.find(".row-container.selected").length,0==a?b.text(b.attr("none")):1==a?b.text(b.attr("one")):b.text(b.attr("many").replace("{nb}",a)))}
function djlst_view_object_popup(a){a.preventDefault();a=$(this);var b=a.closest("div.django-listing-container"),c=b.attr("ajax_url");b.addClass("spinning");var d=b.attr("id"),f=b.attr("listing-suffix");request_data={listing_id:d,listing_suffix:f,action_button:"view_object_popup",serialized_data:a.closest("form").serialize()};update_csrf_token();$.ajax({type:"POST",url:c,data:request_data,success:function(e){b.removeClass("spinning");$("#listing-popup-container").html(e);$("#listing-popup-container > div.modal").modal("show")}})}
function djlst_listing_on_load(){$(".group-by-container").each(function(){let a=$(this).find(".group-by-select");new DualListbox(a[0],{addButtonText:">",removeButtonText:"<",addAllButtonText:">>",removeAllButtonText:"<<",availableTitle:a.attr("available-title")||"Available columns",selectedTitle:a.attr("selected-title")||"Selected columns"});let b=$(this).find(".annotation-select");new DualListbox(b[0],{addButtonText:">",removeButtonText:"<",addAllButtonText:">>",removeAllButtonText:"<<",availableTitle:b.attr("available-title")||
"Available columns",selectedTitle:b.attr("selected-title")||"Selected columns"});$(this).find(".apply-group-by").on("click",function(){var c=a.val().join(",");c=djlst_replaceUrlParam(window.location.href,"gb_cols",c);let d=b.val().join(",");c=djlst_replaceUrlParam(c,"gb_annotate_cols",d);djlst_load_listing_url($(this),c)});$(this).find(".remove-group-by").on("click",function(){let c=djlst_removeUrlParam(window.location.href,"gb_cols");c=djlst_removeUrlParam(c,"gb_annotate_cols");djlst_load_listing_url($(this),
c)})})}
$(document).ready(function(){var a=!1;$("form.listing-form").submit(function(){$(this).find("input[name]").filter(function(){return!this.value}).prop("name","")});$(document.body).on("click","div.django-listing-ajax button.listing-nav",djlst_post_button_action);$(document.body).on("click","div.django-listing-ajax a.listing-nav",djlst_load_listing_href);$(document.body).on("change","div.django-listing-ajax select.listing-nav",djlst_load_listing_val);$(document.body).on("click","div.django-listing-selecting.selection_multiple .row-selector",djlst_multiple_row_select);
$(document.body).on("click","div.django-listing-selecting.selection_unique .row-selector",djlst_unique_row_select);$(document.body).on("click","div.django-listing-selecting .selection-overlay.hover",djlst_activate_selection);$(document.body).on("click","[listing-action='select-all']",djlst_select_all);$(document.body).on("click","[listing-action='unselect-all']",djlst_unselect_all);$(document.body).on("click",".listing-selection-menu .listing-menu-close",djlst_deactivate_selection);$(document.body).on("click",
"li.action-item.view-object-popup a",djlst_view_object_popup);$(document.body).on("click",".button-action-group-by",function(){$(this).closest(".django-listing-container").find(".group-by-container").slideToggle(200)});$('[data-toggle="popover"]').popover();var b=0;$(".dropzone").on("dragenter",function(){b++;$(this).addClass("drag-over")});$(".dropzone").bind("dragleave",function(){b--;0===b&&$(this).removeClass("drag-over")});$(".dropzone").bind("drop",function(){b=0;$(this).removeClass("drag-over")});
$(".submit-action-form").on("click",function(){var c=$(this).val(),d=$(this).closest(".django-listing-container").find(".action-form");d.find(".action-hidden-value").val(c);d.submit()});$(document).on("select2:open",function(c){c=$(c.target).parent().find(".select2-selection").attr("aria-owns");document.querySelector('input[aria-controls="'+c+'"]').focus();a=!0});$("form").keyup(function(c){9==c.keyCode&&(c=$(c.target),c.hasClass("select2-selection")?(a||c.closest(".select2").siblings("select").first().select2("open"),
a=!0):a=!1)});djlst_listing_on_load()});
