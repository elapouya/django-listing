var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");
const MAIN_BLOCK="dual-listbox",CONTAINER_ELEMENT="dual-listbox__container",AVAILABLE_ELEMENT="dual-listbox__available",SELECTED_ELEMENT="dual-listbox__selected",TITLE_ELEMENT="dual-listbox__title",ITEM_ELEMENT="dual-listbox__item",BUTTONS_ELEMENT="dual-listbox__buttons",BUTTON_ELEMENT="dual-listbox__button",SEARCH_ELEMENT="dual-listbox__search",SELECTED_MODIFIER="dual-listbox__item--selected",DIRECTION_UP="up",DIRECTION_DOWN="down";
class DualListbox{constructor(a,b={}){this.setDefaults();this.dragged=null;this.options=[];this.selectedItems=new Set;this.lastSelected=null;this.searchTermRight=this.searchTermLeft="";DualListbox.isDomElement(a)?this.select=a:this.select=document.querySelector(a);this._initOptions(b);this._initReusableElements();void 0!==b.options?this.options=b.options:this._splitOptions(this.select.options);this._buildDualListbox(this.select.parentNode);this._addActions();this.showSortButtons&&this._initializeSortButtons();
this.redraw()}setDefaults(){this.availableTitle="Available options";this.selectedTitle="Selected options";this.showAddButton=!0;this.addButtonText="add";this.showRemoveButton=!0;this.removeButtonText="remove";this.showAddAllButton=!0;this.addAllButtonText="add all";this.showRemoveAllButton=!0;this.removeAllButtonText="remove all";this.searchPlaceholder="Search";this.showSortButtons=!1;this.sortFunction=(a,b)=>0;this.upButtonText="up";this.downButtonText="down";this.multiSelect=this.draggable=this.enableDoubleClick=
!0}changeOrder(a,b){Array.isArray(a)||(a=[a]);a=a.map(c=>({item:c,index:this.options.findIndex(d=>d.value===c.dataset.id)})).sort((c,d)=>c.index-d.index).map(({index:c})=>this.options.splice(c,1)[0]);this.options.splice(b,0,...a)}addOptions(a){a.forEach(b=>{this.addOption(b)})}addOption(a,b=null){null!==b?this.options.splice(b,0,a):this.options.push(a)}addEventListener(a,b){this.dualListbox.addEventListener(a,b)}toggleSelection(a,b){if(this.multiSelect&&(b.ctrlKey||b.metaKey))this.selectedItems.has(a)?
(this.selectedItems.delete(a),a.classList.remove(SELECTED_MODIFIER)):(this.selectedItems.add(a),a.classList.add(SELECTED_MODIFIER));else if(this.multiSelect&&b.shiftKey&&this.lastSelected){b=Array.from(a.parentElement.children);var c=b.indexOf(a);const d=b.indexOf(this.lastSelected),[e,f]=[Math.min(c,d),Math.max(c,d)];this.selectedItems.clear();b.forEach(g=>g.classList.remove(SELECTED_MODIFIER));for(c=e;c<=f;c++)this.selectedItems.add(b[c]),b[c].classList.add(SELECTED_MODIFIER)}else this.selectedItems.clear(),
a.parentElement.querySelectorAll(`.${ITEM_ELEMENT}`).forEach(d=>{d.classList.remove(SELECTED_MODIFIER)}),this.selectedItems.add(a),a.classList.add(SELECTED_MODIFIER);this.lastSelected=a}changeSelected(a){Array.isArray(a)||(a=[a]);a=a.filter(e=>null!=e);if(0!==a.length){var b,c,d=null!=(c=null==(b=a[0].parentElement)?void 0:b.classList.contains(AVAILABLE_ELEMENT))?c:!1;a.forEach(e=>{const f=this.options.find(g=>g.value===e.dataset.id);f&&(f.selected=!f.selected)});this.redraw();setTimeout(()=>{let e=
document.createEvent("HTMLEvents");e.initEvent(d?"added":"removed",!1,!0);e.affectedElements=a;this.dualListbox.dispatchEvent(e)},0)}}_getVisibleItems(a){return Array.from(a.querySelectorAll(`.${ITEM_ELEMENT}`)).filter(b=>"none"!==b.style.display).map(b=>b.dataset.id)}actionAllSelected(a){a&&a.preventDefault();const b=this._getVisibleItems(this.availableList);this.options.forEach(c=>{b.includes(c.value)&&(c.selected=!0)});this.redraw()}actionAllDeselected(a){a&&a.preventDefault();const b=this._getVisibleItems(this.selectedList);
this.options.forEach(c=>{b.includes(c.value)&&(c.selected=!1)});this.redraw()}actionItemSelected(a){a.preventDefault();a=Array.from(this.selectedItems).filter(b=>b.parentElement.classList.contains(AVAILABLE_ELEMENT));0<a.length&&this.changeSelected(a)}actionItemDeselected(a){a.preventDefault();a=Array.from(this.selectedItems).filter(b=>b.parentElement.classList.contains(SELECTED_ELEMENT));0<a.length&&this.changeSelected(a)}redraw(){this.updateAvailableListbox();this.updateSelectedListbox();this._reapplySearchFilters();
this.syncSelect()}searchLists(a,b){let c=b.querySelectorAll(`.${ITEM_ELEMENT}`),d=a.toLowerCase();b===this.availableList?this.searchTermLeft=a:b===this.selectedList&&(this.searchTermRight=a);this._applySearchFilter(c,d)}_applySearchFilter(a,b){for(let c=0;c<a.length;c++){let d=a[c];b&&-1===d.textContent.toLowerCase().indexOf(b)?d.style.display="none":d.style.display="list-item"}}_reapplySearchFilters(){this.searchTermLeft&&this._applySearchFilter(this.availableList.querySelectorAll(`.${ITEM_ELEMENT}`),
this.searchTermLeft.toLowerCase());this.searchTermRight&&this._applySearchFilter(this.selectedList.querySelectorAll(`.${ITEM_ELEMENT}`),this.searchTermRight.toLowerCase())}updateAvailableListbox(){this._updateListbox(this.availableList,this.options.filter(a=>!a.selected))}updateSelectedListbox(){this._updateListbox(this.selectedList,this.options.filter(a=>a.selected))}syncSelect(){for(;this.select.firstChild;)this.select.removeChild(this.select.lastChild);this.options.forEach(a=>{let b=document.createElement("option");
b.value=a.value;b.innerText=a.text;a.selected&&b.setAttribute("selected","selected");this.select.appendChild(b)})}_updateListbox(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);b.forEach(c=>{a.appendChild(this._createListItem(c))})}_addActions(){this._addButtonActions();this._addSearchActions()}_addButtonActions(){this.add_all_button.addEventListener("click",a=>this.actionAllSelected(a));this.add_button.addEventListener("click",a=>this.actionItemSelected(a));this.remove_button.addEventListener("click",
a=>this.actionItemDeselected(a));this.remove_all_button.addEventListener("click",a=>this.actionAllDeselected(a))}_addSearchActions(){this.search_left.addEventListener("input",a=>this.searchLists(a.target.value,this.availableList));this.search_right.addEventListener("input",a=>this.searchLists(a.target.value,this.selectedList))}_addClickActions(a){a.addEventListener("dblclick",b=>{this.enableDoubleClick&&(b.preventDefault(),b.stopPropagation(),this.changeSelected([a]))});a.addEventListener("click",
b=>{b.preventDefault();this.toggleSelection(a,b)});return a}_buildDualListbox(a){this.select.style.display="none";const b=this._createSearchLeft(),c=this._createSearchRight();this.dualListBoxContainer.appendChild(this._createList(b,this.availableListTitle,this.availableList));this.dualListBoxContainer.appendChild(this.buttons);this.dualListBoxContainer.appendChild(this._createList(c,this.selectedListTitle,this.selectedList));this.dualListbox.appendChild(this.dualListBoxContainer);a.insertBefore(this.dualListbox,
this.select)}_createList(a,b,c){let d=document.createElement("div");d.appendChild(a);d.appendChild(b);d.appendChild(c);return d}_createButtons(){this.buttons=document.createElement("div");this.buttons.classList.add(BUTTONS_ELEMENT);this.add_all_button=document.createElement("button");this.add_all_button.innerHTML=this.addAllButtonText;this.add_button=document.createElement("button");this.add_button.innerHTML=this.addButtonText;this.remove_button=document.createElement("button");this.remove_button.innerHTML=
this.removeButtonText;this.remove_all_button=document.createElement("button");this.remove_all_button.innerHTML=this.removeAllButtonText;const a={showAddAllButton:this.add_all_button,showAddButton:this.add_button,showRemoveButton:this.remove_button,showRemoveAllButton:this.remove_all_button};for(let b in a)if(b){const c=this[b],d=a[b];d.setAttribute("type","button");d.classList.add(BUTTON_ELEMENT);c&&this.buttons.appendChild(d)}}_createListItem(a){let b=document.createElement("li");b.classList.add(ITEM_ELEMENT);
b.innerHTML=a.text;b.dataset.id=a.value;this._liListeners(b);this._addClickActions(b);this.draggable&&b.setAttribute("draggable","true");return b}_liListeners(a){a.addEventListener("dragstart",b=>{this.dragged=b.currentTarget;b.currentTarget.classList.add("dragging");this.selectedItems.has(this.dragged)||(this.selectedItems.clear(),this.toggleSelection(this.dragged,{ctrlKey:!1}))});a.addEventListener("dragend",b=>{b.currentTarget.classList.remove("dragging")});a.addEventListener("dragover",b=>{b.preventDefault()});
a.addEventListener("dragenter",b=>{b.target.classList.add("drop-above")});a.addEventListener("dragleave",b=>{b.target.classList.remove("drop-above")});a.addEventListener("drop",b=>{b.preventDefault();b.stopPropagation();b.target.classList.remove("drop-above");const c=this.options.findIndex(e=>e.value===b.target.dataset.id),d=Array.from(this.selectedItems);b.target.parentElement!==this.dragged.parentElement&&this.changeSelected(d);this.changeOrder(d,c);this.redraw()})}_createDragListeners(){[this.availableList,
this.selectedList].forEach(a=>{a.addEventListener("dragover",b=>{b.preventDefault()},!1);a.addEventListener("dragenter",b=>{b.target.classList.add("drop-in")});a.addEventListener("dragleave",b=>{b.target.classList.remove("drop-in")});a.addEventListener("drop",b=>{b.preventDefault();b.target.classList.remove("drop-in");if(a.classList.contains(SELECTED_ELEMENT)||a.classList.contains(AVAILABLE_ELEMENT))b=Array.from(this.selectedItems),this.changeSelected(b)})})}_createSearchWithReset(a){const b=document.createElement("div");
b.classList.add("dual-listbox__search-container");b.style.display="flex";b.style.alignItems="center";b.style.gap="4px";const c=document.createElement("input");c.classList.add(SEARCH_ELEMENT);c.placeholder=this.searchPlaceholder;c.style.flex="1";const d=document.createElement("button");d.type="button";d.classList.add("dual-listbox__search-reset");d.innerHTML="\u00d7";d.style.padding="2px 6px";d.style.border="1px solid #ccc";d.style.borderRadius="3px";d.style.cursor="pointer";d.style.backgroundColor=
"#fff";d.title="Clear search";d.addEventListener("click",()=>{c.value="";"left"===a?(this.searchTermLeft="",this.searchLists("",this.availableList)):(this.searchTermRight="",this.searchLists("",this.selectedList));c.focus()});b.appendChild(c);b.appendChild(d);return{container:b,input:c}}_createSearchLeft(){const {container:a,input:b}=this._createSearchWithReset("left");this.search_left=b;return a}_createSearchRight(){const {container:a,input:b}=this._createSearchWithReset("right");this.search_right=
b;return a}_initOptions(a){for(let b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}_initReusableElements(){this.dualListbox=document.createElement("div");this.dualListbox.classList.add(MAIN_BLOCK);this.select.id&&this.dualListbox.classList.add(this.select.id);this.dualListBoxContainer=document.createElement("div");this.dualListBoxContainer.classList.add(CONTAINER_ELEMENT);this.availableList=document.createElement("ul");this.availableList.classList.add(AVAILABLE_ELEMENT);this.selectedList=document.createElement("ul");
this.selectedList.classList.add(SELECTED_ELEMENT);this.availableListTitle=document.createElement("div");this.availableListTitle.classList.add(TITLE_ELEMENT);this.availableListTitle.innerText=this.availableTitle;this.selectedListTitle=document.createElement("div");this.selectedListTitle.classList.add(TITLE_ELEMENT);this.selectedListTitle.innerText=this.selectedTitle;this._createButtons();this._createSearchLeft();this._createSearchRight();this.draggable&&setTimeout(()=>{this._createDragListeners()},
10)}_initializeSortButtons(){const a=document.createElement("button");a.classList.add(BUTTON_ELEMENT);a.innerText=this.upButtonText;a.addEventListener("click",d=>this._onSortButtonClick(d,DIRECTION_UP));const b=document.createElement("button");b.classList.add(BUTTON_ELEMENT);b.innerText=this.downButtonText;b.addEventListener("click",d=>this._onSortButtonClick(d,DIRECTION_DOWN));const c=document.createElement("div");c.classList.add(BUTTONS_ELEMENT);c.appendChild(a);c.appendChild(b);this.dualListBoxContainer.appendChild(c)}_onSortButtonClick(a,
b){a.preventDefault();a=Array.from(this.selectedItems);if(0<a.length){var c=a.map(e=>this.options.findIndex(f=>f.value===e.dataset.id));const d=Math.min(...c);c=Math.max(...c);this.changeOrder(a,b===DIRECTION_UP?Math.max(0,d-1):Math.min(this.options.length-a.length,c+1));this.redraw()}}_splitOptions(a){[...a].forEach((b,c)=>{this.addOption({text:b.innerHTML,value:b.value,selected:b.hasAttribute("selected"),order:c})})}static isDomElement(a){return"object"===typeof HTMLElement?a instanceof HTMLElement:
a&&"object"===typeof a&&null!==a&&1===a.nodeType&&"string"===typeof a.nodeName}}window.DualListbox=DualListbox;
